<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-button/paper-button.html">

<dom-module id="owc-ui-login-box">
    <template>
        <style>
            * {
                font-family: 'Roboto', 'Noto', sans-serif;
                font-weight: bold;
            }

            .login-title {
                text-align: center;
                font-size: px;
                color: rgb(51, 51, 51);
            }

            #wronglogin {
                color: rgb(190, 0, 0);
            }

            paper-button {
                margin-top: 10px;
                width: 90%;
                height: 30px;
                font-size: 18px;
                background: #002664;
                color: white;
            }
        </style>

        <div>
            <div class="login-title">Account</div>

            <!--USER NOT LOGGED-->
            <div hidden$="{{isLogged}}">
                <h2>{{i18n('Welcome')}}</h2>

                <!-- INPUT FIELDS -->
                <paper-input label="{{i18n('username')}}" id="username" value="{{username::input}}"></paper-input>
                <paper-input label="{{i18n('password')}}" id="password" value="{{password::input}}" type="password"></paper-input>

                <!-- Wrong login div, showed on Bad Credentials -->
                <div id="wronglogin" hidden$="{{!isBadCredentials}}">{{i18n('wrongLogin')}}</div>

                <!-- Login Button -->
                <paper-button raised on-click="tryLogin" title="Login">{{i18n('loginLabel')}}</paper-button>
            </div>

            <!--USER LOGGED-->
            <div hidden$="{{!isLogged}}">logged</div>
        </div>
    </template>

    <!--SCRIPT-->
    <script>
        class OwcUiLoginBox extends Polymer.Element {

            static get is() { return 'owc-ui-login-box'; }
            static get properties() {
                return {
                    isLogged: {
                        type: Boolean,
                        value: false,
                    },
                    username: {
                        type: String,
                    },
                    password: {
                        type: String,
                    },
                    isBadCredentials: {
                        type: Boolean,
                        value: false
                    },
                    _ctx:{
                        type: Object,
                        value: {},
                        observer: '_ctxChanged'
                    }    
                };
            }
            
            _ctxChanged(){
                var self = this;
                console.log("_ctxChanged");
                    // retrieve component dictionary from file (dictionary.json)
                    

                    if(this._ctx && this._ctx.i18n)
                    this._ctx.i18n.append({
                        "Attribute": {
                            "it": "Valore",
                            "es": "aAtributo"
                        },
                        "list": {
                            "it": "lista",
                            "es": "catálogo"
                        },
                        "loginLabel": {
                            "en": "login",
                            "it": "accedi",
                            "es": "acceso"
                        },
                        "password": {
                            "it": "parola chiave",
                            "es": "contraseña "
                        }
                
                });
           
            }

            constructor(){
                
                super();
                console.log("-- constructor");
                

                
            }

            connectedCallback() {
                
                super.connectedCallback();
                console.log("connectedCallback()");
                
                console.log("this._ctx.i18n.dictionaries: ", this._ctx.i18n.dictionaries);

                //// 

               
                


              

            }

            ready(){
                super.ready();
                console.log(this.i18n.dictionaries);
                
            }

            //Try Login with usernme and password in input fields
            /**
            *   @param user: Username as a string
            *   @param pass: Password as a string
            */
            tryLogin() {
                var self = this;
                var user = self.username; //username input field 
                var pass = self.password; //password input field

                // console.log("Auth-Demo TryLogin. USERNAME: ", user, " PASSWORD ", pass)
                var loginResult = self._ctx.am.login(user, pass)
                    .then(function (result) {
                        if (result.status == 200) {
                            self.isLogged = true;
                            self.remove(); //Remove this component
                        } else {
                            self.isLogged = false;
                            self.isBadCredentials = true;
                        }
                    }, function (result) {
                        self.isLogged = false;
                        self.isBadCredentials = true;
                    });
            }
        }
        window.customElements.define(OwcUiLoginBox.is, OwcUiLoginBox);
    </script>
</dom-module>