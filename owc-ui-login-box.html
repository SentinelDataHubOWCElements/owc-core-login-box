<link rel="import" href="../polymer/polymer-element.html">

<!-- Import from Polymer 1 -->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">

<dom-module id="owc-ui-login-box">
    
<!--VIEW-->
<template>
    <!--Internal CSS-->
    <style is="custom-style">
        
        *{
            font-family: 'Roboto', 'Noto', sans-serif;
            margin: 0 auto;
        }

        .login-component{
            width:200px;
        }
        
        .login-title{
            text-align: center;
            font-size: 1.7em;
            font-weight: bold;
            padding-bottom: 50px;
            color: grey;
        }

        #wronglogin {
            font-size: 1.2em;
            color: rgb(190, 0, 0);
        }

        p.info{
            font-size: 0.7em;
            font-weight: bold;
        }

        .info-input{
            margin-bottom: 20px;        
            height: 20px;            
            border-radius: 3px;
        }

        .log-button{
            background-color: #002664;
            margin-top: 20px;
            margin-left: 0 !important;
            width: 170px !important;
            color: aliceblue;
            text-align: center;
            font-size: 1.5em;
            height: 30px;
            border-radius: 3px;
            cursor: pointer;
        }
    </style>

    <!--Demo-1 Template. Login Component simulation-->
    <div class="login-title">Account</div>
    
    <!--NOT LOGGED-->
    <div class="login-component" hidden$="{{isLogged}}">
        <p class="info">Username</p>
        <input class="info-input" id="username" label="username" value="{{username::input}}">
        <p class="info">Password</p>
        <input class="info-input" id="password" label="password" type="password" value="{{password::input}}">

        <!-- Wrong login div, showed on Bad Credentials -->
        <span id="wronglogin" hidden$="{{!isBadCredentials}}">wrong login</span>

        <div class="log-button" on-click="tryLogin" title="Login">Login</div>
    </div>
  
    <!--LOGGED-->
    <div class="login-component" hidden$="{{!isLogged}}">
        <br><p>Logged functions here</p><br>
        <div class="log-button" on-click="tryLogout" title="Logout">Logout</div>
    </div>

    <br>
    <br>
    <br>
    <paper-button>paper button test</paper-button>
            <paper-checkbox>Checkbox</paper-checkbox>
        <paper-checkbox checked>Checkbox</paper-checkbox>
  </template>

  <!--SCRIPT-->
  <script>
    class OwcUiLoginBox extends Polymer.Element {
        static get is() { return 'owc-ui-login-box'; }
        static get properties() {
            return {
                componentName:{
                    type: String,
                    value: 'owc-ui-login-box'
                },

                _ctx: {
                    type: Object,
                    value: {}
                },
                
                //Local variable to set status of UI depending on this variable
                isLogged: {
                    type: Boolean,
                    value: false
                },
                
                //Local varible to show bad credentials message div 
                isBadCredentials: {
                    type: Boolean,
                    value: false
                },

                username:{
                    type: String,
                    value: ""
                },

                password:{
                    type: String,
                    value: ""
                }
            };
        }

        //Method called when this element is created
        constructor(){
            super();
        }

        //Try Login with usernme and password in input fields
        tryLogin(){
            var self = this;
            
            //Get Parameter from Input fields
            var user = self.username;
            var pass = self.password;
            console.log("Auth-Demo TryLogin. USERNAME: ", user, " PASSWORD ", pass)

            //Call authentication-manager login  
            self._ctx.am.login(user, pass);

            //Wait 2 seconds before checking if user is logged
            setTimeout(function() {
                self.checkLogged();
            }, 2000);
        }

        //Try Logout
        tryLogout(){
            var self = this;
            var logoutResult = self._ctx.am.logout();
            
            //If user is logged out properly, set local proper UI
            if(logoutResult == true){
                self.isLogged = !logoutResult; //local variable is the !logout result
            }
        }

        //Check if the user is logged, checking the authentication-manager component logged value
        checkLogged(){
            var self = this;
            var result = self._ctx.am.isLogged(); 
            self.setUI(result);
        }

        setUI(logg){
            var self = this;
            self.isLogged = logg;
            self.isBadCredentials = !logg; //Set bad Credentials to true if result is false
        }
    }
    window.customElements.define(OwcUiLoginBox.is, OwcUiLoginBox);
  </script>
</dom-module>